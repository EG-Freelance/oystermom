<link rel="stylesheet" href="http://blueimp.github.io/Gallery/css/blueimp-gallery.css">
<link rel="stylesheet" href="http://blueimp.github.io/Gallery/css/blueimp-gallery-indicator.css">
<script src="http://blueimp.github.io/Gallery/js/blueimp-helper.js"></script>
<script src="http://blueimp.github.io/Gallery/js/blueimp-gallery.js"></script>
<script src="http://blueimp.github.io/Gallery/js/blueimp-gallery-fullscreen.js"></script>
<script src="http://blueimp.github.io/Gallery/js/blueimp-gallery-indicator.js"></script>

<div width="100%" style="position:relative">
  <h1 style="font-family: oswald;text-align:center"><b><u>Media Gallery</u></b></h1>
  <% if user_signed_in? && current_user.admin? %>
    <button style="position:absolute; right:10px; top:0" class="btn btn-primary" data-toggle="modal" data-target="#upload">Upload Media</button>
  <% end %>
</div>

<div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls">
  <div class="slides"></div>
  <h3 class="title"></h3>
  <a class="prev">‹</a>
  <a class="next">›</a>
  <a class="play-pause"></a>
  <ol class="indicator"></ol>
</div>

<div id="links" class="links">
  <% @media_files.each do |m| %>
    <a href="<%= m.image.url == "/images/original/missing.png" ? m.video.url : m.image.url %>" title="<%= m.image_file_name || m.video_file_name %>" data-gallery="">
      <img src="<%= m.image.url == "/images/original/missing.png" ? m.video.url : m.image.url %>" alt="<%= m.image_file_name || m.video_file_name %>" class="img-thumbnail">
    </a>
  <% end %>
</div>

<!-- Media Upload Modal -->
<div id="upload" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Upload Media File</h4>
      </div>
      <div class="modal-body">
        <%= render 'pages/upload' %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

<script>
document.getElementById('links').onclick = function (event) {
    event = event || window.event;
    var target = event.target || event.srcElement,
        link = target.src ? target.parentNode : target,
        options = {
            index: link,
            event: event
        },
        links = this.getElementsByTagName('a');
    blueimp.Gallery(links, options);
};
</script>